# Import required libraries
import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns
'''
df = pd.read_csv('flights2022.csv')
df1 = pd.read_csv('flights_weather2022.csv')
print(df1.columns)

#print(df.info())
#print(df1.info())

#print(df1['arr_delay'].describe())

df1['dep_time'] = df1['dep_time'].fillna('canceled')

df1['canceled'] = df1['dep_time'] == 'canceled'

def delay_cancel(groupby, sortby):
    
    dataframe = df1.groupby(groupby)['arr_delay', 'canceled'].agg(['mean', 'sum'])
    dataframe = dataframe.drop(columns= [('canceled', 'mean'), ('arr_delay', 'sum')])
    dataframe = dataframe.sort_values(by=sortby, ascending = False)
    dataframe = dataframe.reset_index()
    return dataframe
routes_delays_cancels = delay_cancel('route', ('canceled', 'sum'))
airlines_delays_cancels = delay_cancel('airline', ('arr_delay', 'mean'))

top_9_route = routes_delays_cancels.head(9)
top_9_airline = airlines_delays_cancels.head(9)

top9_route_cancels_bar = sns.barplot(data = top_9_route, x='route', y=('canceled', 'sum'))
plt.xticks(rotation=90)
#plt.show()
top9_airlines_delays_bar = sns.barplot(data = top_9_airline, x='airline', y=('arr_delay', 'mean'))
plt.xticks(rotation=90)
#plt.show()

df1['wind_speeds'] = df1['wind_gust'] >= 10

SEA_PDX = df1[df1['origin'].isin(['SEA', 'PDX'])]
wind_response = SEA_PDX.groupby('wind_speeds')['dep_delay'].mean()
wind_response = True




'''
# Load the data
flights2022 = pd.read_csv("flights2022.csv")
flights_weather2022 = pd.read_csv("flights_weather2022.csv")

# Create route column
flights2022["route"] = flights2022["origin"] + "-" + flights2022["dest"]

# Calculate mean departure delay and number of canceled flights for each unique flight route
routes_delays_cancels = flights2022.groupby("route").agg(
    mean_dep_delay=("dep_delay", "mean"),
    total_cancellations=("dep_time", lambda x: x.isna().sum())
).reset_index()

# Identify routes with the highest mean departure delays
top_routes_by_delay = routes_delays_cancels.sort_values("mean_dep_delay", ascending=False).head(9)

# Identify routes with the highest number of cancellations
top_routes_by_cancellations = routes_delays_cancels.sort_values("total_cancellations", ascending=False).head(9)

# Create a bar graph for highest number of cancellations
top9_route_cancels_bar, ax = plt.subplots()
ax.bar(top_routes_by_cancellations["route"], top_routes_by_cancellations["total_cancellations"])
ax.set_xlabel("Route")
ax.set_ylabel("Total Cancellations")
ax.set_title("Routes with Highest Number of Cancellations")
ax.set_xticklabels(top_routes_by_cancellations["route"], rotation=90)
plt.show()
plt.close()

# Find mean departure delays and total cancellations by airline
airlines_delays_cancels = flights2022.groupby("airline").agg(
    mean_dep_delay=("dep_delay", "mean"),
    total_cancellations=("dep_time", lambda x: x.isna().sum())
).reset_index()

# Identify airlines with the highest mean departure delay
top_airlines_by_delay = airlines_delays_cancels.sort_values("mean_dep_delay", ascending=False).head(9)

# Identify airlines with the highest number of cancellations
top_airlines_by_cancellations = airlines_delays_cancels.sort_values("total_cancellations", ascending=False).head(9)

# Create a bar graph for highest mean depearture delay
top9_airline_delays_bar, ax = plt.subplots()
ax.bar(top_airlines_by_delay["airline"], top_airlines_by_delay["mean_dep_delay"])
ax.set_xlabel("Airline")
ax.set_ylabel("Mean Departure Delay")
ax.set_title("Airlines with Highest Mean Departure Delays")
ax.set_xticklabels(top_airlines_by_delay["airline"], rotation=90)
plt.show()

df1['wind_speeds'] = df1['wind_gust'] >= 10

SEA_PDX = df1[df1['origin'].isin(['SEA', 'PDX'])]
wind_response = SEA_PDX.groupby('wind_speeds')['dep_delay'].mean()
wind_response = True
